{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <header class="site-manager">
        <div class="form-group">
            <label for="siteSelector">
                é¸æ“‡ç«™é»
                <a href="/setup" class="find-sites-link">(è¨­å®š)</a>
                <a href="/logout" class="find-sites-link">(ç™»å‡º)</a>
            </label>
            <div class="site-selector-wrapper">
                <select id="siteSelector"></select>
            </div>
        </div>
    </header>

    <div id="loader" class="loader" style="display: none;">è¼‰å…¥ä¸­...</div>
    <div id="error" class="error-message" style="display: none;"></div>

    <main id="mainContent" class="main-content">
        <header class="content-header">
            <div class="category-selector-wrapper">
                <label for="categorySelector">åˆ†é¡</label>
                <select id="categorySelector"></select>
            </div>
        </header>
        <div class="search-bar-container">
            <div class="search-bar">
                <button id="toSimpBtn" class="btn btn-warning simp-btn" title="è½‰ç‚ºç°¡é«”">ç°¡</button>
                <input type="search" id="searchInput" placeholder="è¼¸å…¥é—œéµå­—æœç´¢..." autocomplete="off">
                <button id="multiSiteSelectBtn" class="btn btn-purple" title="é¸æ“‡å¤šå€‹ç«™å°é€²è¡Œæœå°‹">ç«™å°</button>
                <button id="searchBtn" class="btn btn-info">æœç´¢</button>
            </div>
            <div id="selectedSites" class="selected-sites-display"></div>
            <div id="searchTagsContainer" class="search-tags-container"></div>
        </div>
        <section class="content-area">
            <div id="videoGrid"></div>
            <div id="pagination" class="pagination"></div>
        </section>
    </main>
</div>

<!-- Scroll Buttons -->
<button id="scrollToTopBtn" class="scroll-btn top" title="å›åˆ°é ‚éƒ¨">â–²</button>
<button id="scrollToBottomBtn" class="scroll-btn bottom" title="å»åˆ°åº•éƒ¨">â–¼</button>
<button id="historyBtn" class="scroll-btn history" title="è§€çœ‹æ­·å²">ğŸ“‹</button>

<div id="videoModal" class="modal">
    <div class="modal-content">
        <header class="modal-header">
            <h3 id="modalTitle" class="modal-title"></h3>
            <button class="close-btn">&times;</button>
        </header>
        <main class="modal-body">
            <div id="artplayer-container"></div>
            <div class="playlist-container">
                <div id="playlistSources" class="playlist-sources"></div>
                <div id="episodeList" class="episode-list"></div>
            </div>
        </main>
    </div>
</div>

<div id="siteSelectionModal" class="modal">
    <div class="modal-content">
        <header class="modal-header">
            <h3 class="modal-title">é¸æ“‡æœå°‹ç«™å°</h3>
            <button class="close-btn">&times;</button>
        </header>
        <main class="modal-body" style="flex-direction: column;">
            <div id="siteCheckboxList" class="site-checkbox-list">
                <!-- Site checkboxes will be rendered here by JS -->
            </div>
            <footer class="modal-footer">
                <button id="selectAllSitesBtn" class="btn btn-success">å…¨é¸</button>
                <button id="deselectAllSitesBtn" class="btn btn-secondary">å–æ¶ˆå…¨é¸</button>
                <button id="confirmSiteSelectionBtn" class="btn btn-primary">ç¢ºå®š</button>
            </footer>
        </main>
    </div>
</div>

<div id="historyOverlay" class="history-overlay" style="display: none;"></div>
<div id="historyPanel" class="history-panel" style="display: none;">
    <div class="history-header">
        <button id="historyCloseBtn" class="history-close-header-btn" title="é—œé–‰">Ã—</button>
        <h3>è§€çœ‹æ­·å²</h3>
        <div class="history-actions">
            <button id="clearHistoryBtn" class="btn btn-danger btn-sm">æ¸…é™¤å…¨éƒ¨</button>
        </div>
    </div>
    <div id="watchHistoryContainer" class="history-container">
        <!-- æ­·å²ç´€éŒ„å°‡åœ¨é€™è£¡æ¸²æŸ“ -->
    </div>
    <div class="history-footer">
        <button id="closeHistoryBtn" class="btn btn-danger history-close-btn">é—œé–‰</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/artplayer@5.2.2/dist/artplayer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js"></script>
<script type="module" src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}