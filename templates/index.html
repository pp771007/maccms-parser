{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <header class="site-manager">
        <div class="form-group">
            <label for="siteSelector">
                選擇站點
                <a href="/setup" class="find-sites-link">(設定)</a>
                <a href="/logout" class="find-sites-link">(登出)</a>
            </label>
            <div class="site-selector-wrapper">
                <select id="siteSelector"></select>
            </div>
        </div>
    </header>

    <div id="error" class="error-message" style="display: none;"></div>

    <main id="mainContent" class="main-content">
        <header class="content-header">
            <div class="category-selector-wrapper">
                <label for="categorySelector">分類</label>
                <select id="categorySelector"></select>
            </div>
        </header>
        <div class="search-bar-container">
            <div class="search-bar">
                <button id="toSimpBtn" class="btn btn-warning simp-btn" title="轉為簡體">簡</button>
                <input type="search" id="searchInput" placeholder="輸入關鍵字搜索..." autocomplete="off">
                <button id="multiSiteSelectBtn" class="btn btn-purple" title="選擇多個站台進行搜尋">站台</button>
                <button id="searchBtn" class="btn btn-info">搜索</button>
            </div>
            <div id="selectedSites" class="selected-sites-display"></div>
            <div id="searchTagsContainer" class="search-tags-container"></div>
        </div>
        <section class="content-area">
            <div id="videoGrid"></div>
            <div id="pagination" class="pagination"></div>
        </section>
    </main>
</div>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <p>版本 {{ version }}</p>
    </div>
</footer>

<!-- Scroll Buttons -->
<button id="scrollToTopBtn" class="scroll-btn top" title="回到頂部">▲</button>
<button id="scrollToBottomBtn" class="scroll-btn bottom" title="去到底部">▼</button>
<button id="historyBtn" class="scroll-btn history" title="觀看歷史">📋</button>

<div id="videoModal" class="modal">
    <div class="modal-content">
        <header class="modal-header">
            <h3 id="modalTitle" class="modal-title">
                <span class="title-text"></span>
                <button id="copyTitleBtn" class="copy-title-btn" title="複製標題">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z" />
                    </svg>
                </button>
            </h3>
            <button class="close-btn">&times;</button>
        </header>
        <main class="modal-body">
            <div id="artplayer-container"></div>
            <div class="playlist-container">
                <div id="playlistSources" class="playlist-sources"></div>
                <div id="episodeList" class="episode-list"></div>
            </div>
        </main>
    </div>
</div>

<div id="siteSelectionModal" class="modal">
    <div class="modal-content">
        <header class="modal-header">
            <h3 class="modal-title">選擇搜尋站台</h3>
            <button class="close-btn">&times;</button>
        </header>
        <main class="modal-body" style="flex-direction: column;">
            <div id="siteCheckboxList" class="site-checkbox-list">
                <!-- Site checkboxes will be rendered here by JS -->
            </div>
            <footer class="modal-footer">
                <button id="selectAllSitesBtn" class="btn btn-success">全選</button>
                <button id="deselectAllSitesBtn" class="btn btn-secondary">取消全選</button>
                <button id="confirmSiteSelectionBtn" class="btn btn-primary">確定</button>
            </footer>
        </main>
    </div>
</div>

<div id="historyOverlay" class="history-overlay" style="display: none;"></div>
<div id="historyPanel" class="history-panel" style="display: none;">
    <div class="history-header">
        <button id="historyCloseBtn" class="history-close-header-btn" title="關閉">×</button>
        <h3>觀看歷史</h3>
        <div class="history-actions">
            <button id="clearHistoryBtn" class="btn btn-danger btn-sm">清除全部</button>
        </div>
    </div>
    <div id="watchHistoryContainer" class="history-container">
        <!-- 歷史紀錄將在這裡渲染 -->
    </div>
    <div class="history-footer">
        <button id="closeHistoryBtn" class="btn btn-primary history-close-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
            </svg>
            關閉歷史面板
        </button>
    </div>
</div>

<div id="loader" class="loader" style="display: none;">載入中...</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/artplayer.js') }}"></script>
<script src="{{ url_for('static', filename='js/hls.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/artplayer-plugin-chromecast.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}