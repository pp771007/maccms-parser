# 資源站點管理器 v5.9

一個基於Flask的資源站點管理工具，支援多站點聚合搜尋和自動健康檢查。

## 主要功能

### 🔍 搜尋功能
- **單站點搜尋**: 選擇單一站點進行影片搜尋
- **多站點聚合搜尋**: 同時搜尋多個站點，結果自動聚合
- **影片聚合顯示**: 相同名稱的影片會聚合顯示，並標示來源站點
- **分類瀏覽**: 支援按分類瀏覽影片

### 🏥 站點健康檢查
- **自動檢查**: 每小時自動檢查所有啟用站點的健康狀態
- **失敗處理**: 檢查失敗的站點會自動設為停用
- **手動檢查**: 支援手動觸發站點檢查
- **狀態監控**: 提供站點狀態統計資訊

### 💾 設定記憶
- **單選站台記憶**: 記住上次選擇的單一站台
- **多選站台記憶**: 記住多選站台的選擇設定
- **搜尋歷史**: 記住搜尋關鍵字和頁面狀態

### 🔐 安全認證
- **密碼保護**: 支援密碼設定和登入驗證
- **Session管理**: 30天session過期時間，減少重複登入
- **登入保護**: 防止暴力破解，超過嘗試次數會鎖定帳戶

### 🎬 播放功能
- **多來源播放**: 支援多個播放來源選擇
- **聚合影片處理**: 相同影片的多個來源可以統一選擇
- **播放器整合**: 內建DPlayer播放器

## 技術特點

### 效能優化
- **Thread處理**: 多站點搜尋使用ThreadPoolExecutor並行處理
- **Timeout控制**: 所有API請求使用10秒timeout
- **圖片優化**: 改善圖片URL處理，避免中文編碼問題

### 錯誤處理
- **網路錯誤**: 完善的網路錯誤處理和重試機制
- **API錯誤**: 處理各種API回應錯誤
- **用戶體驗**: 友好的錯誤提示和狀態顯示

## 安裝與使用

### 環境要求
- Python 3.7+
- Flask
- requests

### 安裝步驟
1. 克隆專案
```bash
git clone <repository-url>
cd maccms_parser
```

2. 安裝依賴
```bash
pip install -r requirements.txt
```

3. 啟動應用
```bash
python web_app.py
```

4. 訪問應用
```
http://127.0.0.1:5000
```

### 首次使用
1. 設定管理員密碼
2. 新增資源站點
3. 開始搜尋和瀏覽影片

## API端點

### 站點管理
- `GET /api/sites` - 獲取站點列表
- `POST /api/sites` - 新增站點
- `PUT /api/sites/<id>` - 更新站點
- `DELETE /api/sites/<id>` - 刪除站點
- `POST /api/sites/<id>/move` - 移動站點順序

### 搜尋功能
- `POST /api/list` - 單站點搜尋
- `POST /api/details` - 獲取影片詳情
- `POST /api/multi_site_search` - 多站點聚合搜尋



## 配置說明

### 站點設定
- `name`: 站點名稱
- `url`: 站點API地址
- `enabled`: 是否啟用
- `ssl_verify`: SSL驗證設定
- `note`: 備註說明

### 系統設定
- `secret_key`: 應用密鑰
- `password_hash`: 管理員密碼雜湊
- `session_lifetime`: Session過期時間（30天）

## 更新日誌

### v5.9
- ✅ 新增站點健康檢查機制（每小時自動檢查）
- ✅ 所有API請求timeout改為10秒
- ✅ 多選站台選項記憶功能
- ✅ 改善圖片URL處理，解決中文編碼問題
- ✅ 多選站台查詢使用thread處理
- ✅ 影片名字聚合顯示功能
- ✅ 解決密碼重複輸入問題（30天session）
- ✅ 新增站點狀態監控API

### 技術改進
- 使用ThreadPoolExecutor進行並行處理
- 改善錯誤處理和用戶體驗
- 優化記憶體使用和效能
- 增強安全性設定

## 授權

本專案採用MIT授權條款。
